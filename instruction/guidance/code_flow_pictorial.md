# ISA Flight Software Code Flow

## System Architecture

```
                    +----------------+
                    |                |
                    |  Real-Time OS  |
                    |                |
                    +--------+-------+
                             |
             +---------------+---------------+
             |               |               |
    +--------v-------+ +-----v------+ +------v-------+
    |                | |            | |              |
    |   Sequencer    | | Navigation | |   Guidance   |
    |                | |            | |              |
    +--------+-------+ +-----+------+ +------+-------+
             |               |               |
             |               |               |
             |               |        +------v-------+
             |               |        |              |
             |               +------->|      DAP     |
             |                        |              |
             |                        +------+-------+
             |                               |
             |                               |
             +-------------------+-----------+
                                 |
                         +-------v--------+
                         |                |
                         |    Actuator    |
                         |    Interface   |
                         |                |
                         +----------------+
```

## Navigation Module Data Flow

```
    +-------------+     +-------------+     +-------------+
    |             |     |             |     |             |
    |     IMU     |     |    GNSS     |     | Magnetometer|
    |             |     |             |     |             |
    +------+------+     +------+------+     +------+------+
           |                   |                   |
           |                   |                   |
    +------v-------------------v-------------------v------+
    |                                                     |
    |               Sensor Data Preprocessing             |
    |                                                     |
    +---------------------+-----------------------------+-+
                          |                             |
                +---------v---------+         +---------v---------+
                |                   |         |                   |
                | Attitude & Body   |         |   Position &      |
                | Rate Computation  |         |Velocity Computation|
                |                   |         |                   |
                +---------+---------+         +---------+---------+
                          |                             |
                          |                             |
                +---------v---------+         +---------v---------+
                |                   |         |                   |
                |        DAP        |         |     Guidance      |
                |                   |         |                   |
                +-------------------+         +-------------------+
```

## Guidance Algorithm Flow

```
    +-------------+     +-------------+
    |             |     |             |
    |  Position   |     |  Velocity   |
    |             |     |             |
    +------+------+     +------+------+
           |                   |
           |                   |
    +------v-------------------v------+
    |                                 |
    |    Coordinate Transformations   |
    |                                 |
    +---------------+----------------+
                    |
          +---------v----------+
          |                    |
          | Target-LOS Vector  |
          | Computation        |
          |                    |
          +---------+----------+
                    |
                    |
    +---------------v----------------+
    |                                |
    |   Proportional Navigation      |
    |   with Impact Angle Control    |
    |                                |
    +---------------+----------------+
                    |
                    |
          +---------v----------+
          |                    |
          |  Acceleration      |
          |  Command           |
          |                    |
          +---------+----------+
                    |
                    |
    +---------------v----------------+
    |                                |
    |   Coordinate Transformation    |
    |   to Body Frame                |
    |                                |
    +---------------+----------------+
                    |
                    v
               To DAP Module
```

## Flight Sequence Timeline

```
T0                                                                      Impact
|                                                                          |
v                                                                          v
+----------+------+-----+-----+-------+------+-------+---------+-----------+
|          |      |     |     |       |      |       |         |           |
| Fire     | OBC  | FSA | Canard| Roll | Pitch/Yaw | Guidance | Proximity | Target
| Sensing  | Reset| Act | Deploy| Ctrl | Control   | Active   | Sensor    | Hit
|          |      |     |       |      |           |          | Active    |
+----------+------+-----+-------+------+-----------+----------+-----------+
           ^      ^     ^       ^      ^           ^          ^           ^
           |      |     |       |      |           |          |           |
           T0+Δt1 T0+Δt2 T1     T2     T2+Δt4      T2+2s      T3          T3+Δt
```

## Control Loop Execution

```
    +-------------+
    |             |     +-------------+
    | Navigation  +---->|             |
    | (100 Hz)    |     |  Guidance   |
    +-------------+     |  (100 Hz)   |
                        |             |
    +-------------+     |             |
    |             |     |             |
    |    GNSS     +---->|             |
    |   (10 Hz)   |     +------+------+
    +-------------+            |
                              |
                        +-----v------+
                        |            |
                        |    DAP     |
                        |  (100 Hz)  |
                        |            |
                        +-----+------+
                              |
                              |
                        +-----v------+
                        |            |
                        |  Actuator  |
                        | Interface  |
                        |            |
                        +------------+
```

## Memory Layout

```
    +-----------------------------------+
    |                                   |
    |           Flash Memory            |
    |                                   |
    +-----------------------------------+
    | Program Code                      |
    +-----------------------------------+
    | Constant Data                     |
    +-----------------------------------+
    | Calibration Parameters            |
    +-----------------------------------+
    | Configuration Data                |
    +-----------------------------------+

    +-----------------------------------+
    |                                   |
    |               RAM                 |
    |                                   |
    +-----------------------------------+
    | Stack                             |
    +-----------------------------------+
    | Global Variables                  |
    +-----------------------------------+
    | Sensor Data Buffers               |
    +-----------------------------------+
    | Navigation State                  |
    +-----------------------------------+
    | Guidance State                    |
    +-----------------------------------+
    | DAP State                         |
    +-----------------------------------+
```
